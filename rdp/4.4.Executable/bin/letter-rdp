#!/usr/bin/python
import sys
import json
import os

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from rdp import Parser

usage = '''usage: letter-rdp [<option>] <argument>
-e <expr>, --eval <expr>
    Evaluate <expr>, print result
-f <file>, --file <file>
    Execute expressions from <file>'''

def main():
    if len(sys.argv) >= 3:
        _path, mode, *args = sys.argv
        parser = Parser()
        ast = None
        if (mode == '-e' or mode == '--eval'):
            ast = parser.parse(args[0])

        if (mode == '-f' or mode == '--file'):
            path = args[0]
            with open(path, 'r') as f:
                source = f.read()
                ast = parser.parse(source)
        print(json.dumps(ast, indent=2))
    else:
        return usage

if __name__ == '__main__':
    main()
