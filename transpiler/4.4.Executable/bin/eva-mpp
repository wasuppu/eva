#!/usr/bin/python
import sys
import os

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from EvaMPP import EvaMPP

usage = '''usage: eva-mpp [<option>] <argument>
-e <expr>, --eval <expr>
    Evaluate <expr>, print result
-f <file>, --file <file>
    Execute expressions from <file>'''

def main():
    if len(sys.argv) >= 3:
        _path, mode, *args = sys.argv
        eva = EvaMPP()
        program = None
        # 1. Direct expression:
        if mode == '-e' or mode == '--eval':
            program = args[0]

        if mode == '-f' or mode == '--file':
            path = args[0]
            with open(path, 'r') as f:
                program = f.read()

        target = eva.compile(program, './out.js')['target']
        print(target)
    else:
        print(usage)

if __name__ == '__main__':
    main()